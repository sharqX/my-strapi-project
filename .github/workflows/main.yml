name: Deloy to EC2

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
  steps:
  - name: Check code
    uses: actions/checkout@v2

  - name: Install SSH client
    run: sudo apt-get install openssh-client

  - name: SSH into EC2 instance and deploy Strapi
    uses: appleboy/ssh-action@master
    with:
      host: ${{ secrets.RAVI_EC2_PUBLIC_IP }}
      username: ubuntu
      key: ${{ secrets.RAVI_PRIVATE_SSH_KEY }}
      script: |
        cd my-strapi-project
        sudo git pull 
        pm2 stop server
        sudo npm install
        pm2 restart server
        pm2 save
                 

